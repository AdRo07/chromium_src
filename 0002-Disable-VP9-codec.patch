From 05833b2b7e61c4396bbbe3a82c9d4ebd551881a9 Mon Sep 17 00:00:00 2001
From: Robert Yang <decatf@gmail.com>
Date: Wed, 5 Dec 2018 13:01:32 -0500
Subject: [PATCH 2/4] Disable VP9 codec

---
 components/cdm/browser/cdm_message_filter_android.cc | 3 ---
 media/filters/stream_parser_factory.cc               | 3 +++
 media/filters/vpx_video_decoder.cc                   | 4 ++++
 3 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/components/cdm/browser/cdm_message_filter_android.cc b/components/cdm/browser/cdm_message_filter_android.cc
index 7a986ed84a6..dcfa0157c3e 100644
--- a/components/cdm/browser/cdm_message_filter_android.cc
+++ b/components/cdm/browser/cdm_message_filter_android.cc
@@ -38,9 +38,6 @@ struct CodecInfo {
 
 const CodecInfo<media::VideoCodec> kVideoCodecsToQuery[] = {
     {media::EME_CODEC_VP8, media::kCodecVP8, "video/webm"},
-    {media::EME_CODEC_LEGACY_VP9, media::kCodecVP9, "video/webm"},
-    {media::EME_CODEC_VP9, media::kCodecVP9, "video/webm"},
-    {media::EME_CODEC_VP9, media::kCodecVP9, "video/mp4"},
 #if BUILDFLAG(USE_PROPRIETARY_CODECS)
     {media::EME_CODEC_AVC1, media::kCodecH264, "video/mp4"},
 #if BUILDFLAG(ENABLE_HEVC_DEMUXING)
diff --git a/media/filters/stream_parser_factory.cc b/media/filters/stream_parser_factory.cc
index 276164cc1e5..27500879b02 100644
--- a/media/filters/stream_parser_factory.cc
+++ b/media/filters/stream_parser_factory.cc
@@ -420,6 +420,9 @@ static bool VerifyCodec(const CodecInfo* codec_info,
       }
 #endif
 
+      if (codec_info->tag == CodecInfo::HISTOGRAM_VP9)
+          return false;
+
       if (video_codecs)
         video_codecs->push_back(codec_info->tag);
       return true;
diff --git a/media/filters/vpx_video_decoder.cc b/media/filters/vpx_video_decoder.cc
index 3eac5c90865..5e1c3f33c4b 100644
--- a/media/filters/vpx_video_decoder.cc
+++ b/media/filters/vpx_video_decoder.cc
@@ -1,3 +1,4 @@
+
 // Copyright (c) 2012 The Chromium Authors. All rights reserved.
 // Use of this source code is governed by a BSD-style license that can be
 // found in the LICENSE file.
@@ -232,6 +233,9 @@ bool VpxVideoDecoder::ConfigureDecoder(const VideoDecoderConfig& config) {
   if (config.codec() != kCodecVP8 && config.codec() != kCodecVP9)
     return false;
 
+  if (config.codec() == kCodecVP9)
+    return false;
+
   // These are the combinations of codec-pixel format supported in principle.
   DCHECK(
       (config.codec() == kCodecVP8 && config.format() == PIXEL_FORMAT_I420) ||
-- 
2.17.1

